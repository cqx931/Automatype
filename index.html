<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Automatype</title>
    <script src="node_modules/p5/lib/p5.js" type="text/javascript"></script>
    <script src="node_modules/rita/lib/rita.js" type="text/javascript"></script>
    <script src="lib/rt.js" type="text/javascript"></script>
    <script src="lookup.js" type="text/javascript"></script>
    <script>

// ----------------------------------------------------------
var INITIAL_KEY_PAUSE = .8, REPLACE_PAUSE = 1.6, SUCCESS_PAUSE = .8;
var REPLACE_ACTION = 1, DELETE_ACTION = 2, INSERT_ACTION = 3;

var lexLook, word, target, nextAction, hq;

function setup() {

  createCanvas(680, 490);
  textFont('courier', 150);
  textAlign(CENTER, CENTER);
  //console.log(hq, Object.keys(hq));

  hq = new HistoryQueue(20);
  lexLook = new LexiconLookup();
  word = lexLook.randomWord(4);
  //setTimeout(nextEdit, INITIAL_KEY_PAUSE);
  console.log(lexLook.mutateWord(word));
}

function nextEdit() {

  if (target.length() < 1)
  {
    pickNextTarget();
    findNextEdit();
    return;
  }

  /*switch (nextAction)
  {
    case DELETE_ACTION:
      doInsertOrDelete(false);
      break;
    case INSERT_ACTION:
      doInsertOrDelete(true);
      break;
    default: // REPLACE
      doReplace();
  }*/
}

function pickNextTarget() {

  // String tmpHist = lexLook.getHistory(this)+"";
  var next, prob;

  // try deletions
  if (!next) {
    prob = max(0, word.length() - parent.minWordLen) * .1;
    if (Math.random() < prob) {
      nextAction = DELETE_ACTION;
      next = lexLook.getDeletion();
      //console.log("DELETE: next="+next+" curr="+word.cursorIdx);
    }
  }

  // try insertions
  if (!next) {
    prob = max(0, parent.maxWordLen - word.length()) * .1;
    if (Math.random() < prob) {
      nextAction = INSERT_ACTION;
      next = lexLook.getInsertion();
    }
  }

  // try mutations
  if (!next) {
    nextAction = REPLACE_ACTION;
    next = lexLook.mutateWord();
  }

  // add to hq and set target text
  hq.add(next);
  target = next;
/*
  var pause = SUCCESS_PAUSE;
  if (firstWord)
    pause = id + .1f; // start cells staggered
  RiTa.pauseCallbackTimer(getPApplet(), getTimerName(), pause); */
}

function draw() {
  background(245);
  text(word, width/2, height/2);
  noLoop();
}

    </script>
  </head>
  <body>
  </body>
</html>
