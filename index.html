<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Automatype</title>
    <script src="node_modules/p5/lib/p5.js" type="text/javascript"></script>
    <script src="node_modules/rita/lib/rita.js" type="text/javascript"></script>
    <script src="lib/rt.js" type="text/javascript"></script>
    <script src="lookup.js" type="text/javascript"></script>
    <script>

const INITIAL_KEY_PAUSE = 0.8, REPLACE_PAUSE = 1.6, SUCCESS_PAUSE = 0.8;
var REPLACE_ACTION = 1, DELETE_ACTION = 2, INSERT_ACTION = 3;

var lexLook, word, target, nextAction, hq, minWordLen, maxWordLen;

function setup() {
  createCanvas(680, 490);
  textFont('courier', 150);
  textAlign(CENTER, CENTER);
  //console.log(hq, Object.keys(hq));

  lexLook = new LexiconLookup();
  lexLook.dbug = 1;
  word = lexLook.randomWord(7);
  word = "mourner";
  lexLook.hq.add("mourned");

  // WORKING HERE: should not fail, but do relax constraints until hit (ses test.js)
  for (var i = 0; i < 10; i++) {
    pickNextTarget();
    console.log(target);
    word = target;
  }

}

function nextEdit() {
  if (target.length() < 1) {
    pickNextTarget();
    findNextEdit();
    return;
  }

  /*switch (nextAction)
  {
    case DELETE_ACTION:
      doInsertOrDelete(false);
      break;
    case INSERT_ACTION:
      doInsertOrDelete(true);
      break;
    default: // REPLACE
      doReplace();
  }*/
}

function pickNextTarget() {
  //console.log('pickNextTarget: '+word);
  // String tmpHist = lexLook.getHistory(this)+"";
  var next, prob;

  // try deletions
  if (!next) {
    prob = max(0, word.length - parent.minWordLen) * 0.1;
    if (Math.random() < prob) {
      nextAction = DELETE_ACTION;
      next = lexLook.getDeletion(word);
      //console.log("DELETE: next="+next+" curr="+word.cursorIdx);
    }
  }

  // try insertions
  if (!next) {
    prob = max(0, parent.maxWordLen - word.length) * 0.1;
    if (Math.random() < prob) {
      nextAction = INSERT_ACTION;
      next = lexLook.getInsertion(word);
    }
  }

  // try mutations
  if (!next) {
    nextAction = REPLACE_ACTION;
    next = lexLook.mutateWord(word);
  }

  // add to hq and set target text
  lexLook.hq.add(next);
  target = next;
  /*
  var pause = SUCCESS_PAUSE;
  if (firstWord)
    pause = id + .1f; // start cells staggered
  RiTa.pauseCallbackTimer(getPApplet(), getTimerName(), pause); */
}

function draw() {
  background(245);
  text(word, width / 2, height / 2);
  noLoop();
}
</script>
  </head>
  <body>
  </body>
</html>
